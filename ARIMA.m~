%% ARIMA NASDAQ

load('NDX.mat');
y = NDX;
T = length(y);
t = (1:T);
ly = log(y);               
K = (0:20)';   
%% Stima modelli ARIMA
%ARIMA(1,1,0)
Mdl = arima(1,1,0);           % definizione del modello ARIMA(1,1,0)
EstMdl10 = estimate(Mdl,ly);  % stima del modello definito sui dati della serie storica
res10 = infer(EstMdl10,ly);
% ARIMA(0,1,1)
Mdl = arima(0,1,1);             
EstMdl01 = estimate(Mdl,ly);
res01 = infer(EstMdl01,ly);
% ARIMA(1,1,1)
Mdl = arima(1,1,1);
EstMdl11 = estimate(Mdl,ly);
res11 = infer(EstMdl11,ly);
% ARIMA(2,1,0)
Mdl = arima(2,1,0);
EstMdl20 = estimate(Mdl,ly);
res20 = infer(EstMdl20,ly);
% ARIMA(0,1,2)
Mdl = arima(0,1,2);
EstMdl02 = estimate(Mdl,ly);
res02 = infer(EstMdl02,ly);
% ARIMA(2,1,1)
Mdl = arima(2,1,1);
EstMdl21 = estimate(Mdl,ly);
res21 = infer(EstMdl21,ly);
% ARIMA(1,1,2)
Mdl = arima(1,1,2);
EstMdl12 = estimate(Mdl,ly);
res12 = infer(EstMdl12,ly);
% ARIMA(2,1,2)
Mdl = arima(2,1,2);
EstMdl22 = estimate(Mdl,ly);
res22 = infer(EstMdl22,ly);
% ARIMA(2,1,0), 3-4
Mdl = arima('ArLags',[3 4],'D',1,'MaLags',[]);
EstMdl340 = estimate(Mdl,ly);
res340 = infer(EstMdl340,ly);
% ARIMA(0,1,2), 3-4
Mdl = arima('ArLags',[],'D',1,'MaLags',[3 4]);
EstMdl034 = estimate(Mdl,ly);
res034 = infer(EstMdl034,ly);
% ARIMA(2,1,2), 3-4
Mdl = arima('ArLags',[3 4],'D',1,'MaLags',[3 4]);
EstMdl3434 = estimate(Mdl,ly);
res3434 = infer(EstMdl3434,ly);


%% 3) Analisi dei residui
%Valutiamo la qualità del modello specificato analizzando la distribuzione dei residui della regressione.

%% ARIMA(1,1,0)
figure
subplot(2,2,1)
histogram(res10,60)                       % istogramma dei residui
title('Istogramma residui')
subplot(2,2,2)
qqplot(res10)                             % qqplot dei residui
subplot(2,2,3)
autocorr(res10)                           % correlogramma
subplot(2,2,4)
parcorr(res10)

%% ARIMA(0,1,1)
figure
subplot(2,2,1)
histogram(res01,60)                       % istogramma dei residui
title('Istogramma residui')
subplot(2,2,2)
qqplot(res01)                             % qqplot dei residui
subplot(2,2,3)
autocorr(res01)                           % correlogramma
subplot(2,2,4)
parcorr(res01)

%% ARIMA(0,1,1)
figure
subplot(2,2,1)
histogram(res11,60)                       % istogramma dei residui
title('Istogramma residui')
subplot(2,2,2)
qqplot(res11)                             % qqplot dei residui
subplot(2,2,3)
autocorr(res11)                           % correlogramma
subplot(2,2,4)
parcorr(res11)

%% ARIMA(1,1,1)
figure
subplot(2,2,1)
histogram(res11,60)                       % istogramma dei residui
title('Istogramma residui')
subplot(2,2,2)
qqplot(res11)                             % qqplot dei residui
subplot(2,2,3)
autocorr(res11)                           % correlogramma
subplot(2,2,4)
parcorr(res11)

%% ARIMA(2,1,0)
figure
subplot(2,2,1)
histogram(res20,60)                       % istogramma dei residui
title('Istogramma residui')
subplot(2,2,2)
qqplot(res20)                             % qqplot dei residui
subplot(2,2,3)
autocorr(res20)                           % correlogramma
subplot(2,2,4)
parcorr(res20)

%% ARIMA(0,1,2)
figure
subplot(2,2,1)
histogram(res11,60)                       % istogramma dei residui
title('Istogramma residui')
subplot(2,2,2)
qqplot(res11)                             % qqplot dei residui
subplot(2,2,3)
autocorr(res11)                           % correlogramma
subplot(2,2,4)
parcorr(res11)

%% ARIMA(2,1,1)
figure
subplot(2,2,1)
histogram(res21,60)                       % istogramma dei residui
title('Istogramma residui')
subplot(2,2,2)
qqplot(res21)                             % qqplot dei residui
subplot(2,2,3)
autocorr(res21)                           % correlogramma
subplot(2,2,4)
parcorr(res21)

%% ARIMA(1,1,2)
figure
subplot(2,2,1)
histogram(res12,60)                       % istogramma dei residui
title('Istogramma residui')
subplot(2,2,2)
qqplot(res12)                             % qqplot dei residui
subplot(2,2,3)
autocorr(res12)                           % correlogramma
subplot(2,2,4)
parcorr(res12)

%% ARIMA(2,1,2)
figure
subplot(2,2,1)
histogram(res22,60)                       % istogramma dei residui
title('Istogramma residui')
subplot(2,2,2)
qqplot(res22)                             % qqplot dei residui
subplot(2,2,3)
autocorr(res22)                           % correlogramma
subplot(2,2,4)
parcorr(res22)

%% ARIMA(2,1,0) 3-4
figure
subplot(2,2,1)
histogram(res340,60)                       % istogramma dei residui
title('Istogramma residui')
subplot(2,2,2)
qqplot(res340)                             % qqplot dei residui
subplot(2,2,3)
autocorr(res340)                           % correlogramma
subplot(2,2,4)
parcorr(res340)

%% ARIMA(0,1,2) 3-4
figure
subplot(2,2,1)
histogram(res034,60)                       % istogramma dei residui
title('Istogramma residui')
subplot(2,2,2)
qqplot(res034)                             % qqplot dei residui
subplot(2,2,3)
autocorr(res034)                           % correlogramma
subplot(2,2,4)
parcorr(res034)

%% ARIMA(2,1,2)
figure
subplot(2,2,1)
histogram(res3434,60)                       % istogramma dei residui
title('Istogramma residui')
subplot(2,2,2)
qqplot(res3434)                             % qqplot dei residui
subplot(2,2,3)
autocorr(res3434)                           % correlogramma
subplot(2,2,4)
parcorr(res3434)
